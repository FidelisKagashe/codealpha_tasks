{% extends 'base.html' %}

{% block title %}Explore - Social Media{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h2 class="text-2xl font-bold mb-6">Explore Posts</h2>

    {% if posts %}
        {% for post in posts %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md mb-6">
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <a href="{% url 'profile' post.author.username %}">
                            {% if post.author.profile.profile_picture %}
                            <img src="{{ post.author.profile.profile_picture.url }}" alt="{{ post.author.username }}" class="w-10 h-10 rounded-full object-cover">
                            {% else %}
                            <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                                {{ post.author.username|first|upper }}
                            </div>
                            {% endif %}
                        </a>
                        <div>
                            <a href="{% url 'profile' post.author.username %}" class="font-semibold hover:underline">
                                {{ post.author.username }}
                            </a>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ post.created_at|timesince }} ago</p>
                        </div>
                    </div>
                </div>

                <p class="text-gray-800 dark:text-gray-200 mb-3">{{ post.content }}</p>

                {% if post.image %}
                <img src="{{ post.image.url }}" alt="Post image" class="w-full rounded-lg mb-3">
                {% endif %}

                <div class="flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700">
                    <button onclick="likePost({{ post.pk }})" id="like-btn-{{ post.pk }}"
                            class="flex items-center space-x-2 text-gray-600 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition">
                        <i class="{% if user in post.likes.all %}fas{% else %}far{% endif %} fa-heart"></i>
                        <span id="like-count-{{ post.pk }}">{{ post.likes_count }}</span>
                    </button>
                    <a href="{% url 'post_detail' post.pk %}" class="flex items-center space-x-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition">
                        <i class="far fa-comment"></i>
                        <span>{{ post.comments_count }}</span>
                    </a>
                    <a href="{% url 'post_detail' post.pk %}" class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition">
                        <i class="far fa-share-square"></i>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center">
        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
        <h3 class="text-xl font-semibold mb-2">No posts found</h3>
        <p class="text-gray-600 dark:text-gray-400">Be the first to create a post!</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function likePost(postId) {
    fetch(`/post/${postId}/like/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        const likeBtn = document.querySelector(`#like-btn-${postId} i`);
        const likeCount = document.getElementById(`like-count-${postId}`);

        if (data.liked) {
            likeBtn.classList.remove('far');
            likeBtn.classList.add('fas');
        } else {
            likeBtn.classList.remove('fas');
            likeBtn.classList.add('far');
        }

        likeCount.textContent = data.likes_count;
    });
}
</script>
{% endblock %}
